# 웹사이트 튜토리얼 구현 가이드

## 개요
사용자가 처음 웹사이트에 접속했을 때 제공되는 인터랙티브 튜토리얼 구현 방법을 설명합니다. 사용자 경험을 향상시키고 기능 사용법을 효과적으로 안내할 수 있습니다.

## 튜토리얼 시스템의 구성 요소

### 1. 핵심 구성 요소
- **Step-by-step 가이드**: 순차적 단계별 안내
- **하이라이트 오버레이**: 특정 요소 강조 표시
- **툴팁 및 말풍선**: 설명 텍스트 표시
- **진행률 표시**: 현재 단계와 전체 진행률
- **건너뛰기/다시보기**: 사용자 선택권 제공

### 2. 상태 관리
- **튜토리얼 완료 여부**: DB 또는 로컬스토리지 저장
- **현재 단계**: 어느 단계까지 진행했는지 추적
- **사용자 설정**: 튜토리얼 표시 여부 설정

## 구현 방법

### 1단계: 튜토리얼 라이브러리 설치

```bash
# 인기 있는 튜토리얼 라이브러리들
npm install react-joyride        # 가장 인기 있는 라이브러리
npm install intro.js             # 클래식한 선택
npm install shepherd.js          # 유연한 커스터마이징
npm install reactour            # React 전용
```

### 2단계: 기본 튜토리얼 컴포넌트 구현

```typescript
// components/tutorial/TutorialProvider.tsx
'use client';

import React, { createContext, useContext, useState, useEffect } from 'react';
import Joyride, { CallBackProps, STATUS, Step } from 'react-joyride';

interface TutorialContextType {
  startTutorial: (steps: Step[]) => void;
  isRunning: boolean;
  currentStep: number;
}

const TutorialContext = createContext<TutorialContextType | null>(null);

export const useTutorial = () => {
  const context = useContext(TutorialContext);
  if (!context) {
    throw new Error('useTutorial must be used within TutorialProvider');
  }
  return context;
};

interface TutorialProviderProps {
  children: React.ReactNode;
}

export default function TutorialProvider({ children }: TutorialProviderProps) {
  const [run, setRun] = useState(false);
  const [steps, setSteps] = useState<Step[]>([]);
  const [stepIndex, setStepIndex] = useState(0);

  const startTutorial = (tutorialSteps: Step[]) => {
    setSteps(tutorialSteps);
    setStepIndex(0);
    setRun(true);
  };

  const handleJoyrideCallback = (data: CallBackProps) => {
    const { status, index, action } = data;

    if ([STATUS.FINISHED, STATUS.SKIPPED].includes(status)) {
      setRun(false);
      setStepIndex(0);
      // 튜토리얼 완료 상태 저장
      saveTutorialCompletion();
    } else if (action === 'next' || action === 'prev') {
      setStepIndex(index + (action === 'next' ? 1 : -1));
    }
  };

  const saveTutorialCompletion = async () => {
    try {
      // 로컬스토리지에 저장
      localStorage.setItem('tutorial-completed', 'true');
      
      // 또는 데이터베이스에 저장
      await fetch('/api/user/tutorial-status', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ completed: true }),
      });
    } catch (error) {
      console.error('튜토리얼 완료 상태 저장 실패:', error);
    }
  };

  return (
    <TutorialContext.Provider
      value={{
        startTutorial,
        isRunning: run,
        currentStep: stepIndex,
      }}
    >
      {children}
      <Joyride
        steps={steps}
        run={run}
        stepIndex={stepIndex}
        callback={handleJoyrideCallback}
        continuous
        showProgress
        showSkipButton
        styles={{
          options: {
            primaryColor: '#3b82f6',
            backgroundColor: '#ffffff',
            textColor: '#374151',
            overlayColor: 'rgba(0, 0, 0, 0.5)',
            arrowColor: '#ffffff',
            zIndex: 1000,
          },
          tooltip: {
            borderRadius: '8px',
            fontSize: '14px',
          },
          buttonNext: {
            backgroundColor: '#3b82f6',
            borderRadius: '6px',
            color: '#ffffff',
            fontSize: '14px',
            padding: '8px 16px',
          },
          buttonBack: {
            color: '#6b7280',
            fontSize: '14px',
            marginRight: '8px',
          },
          buttonSkip: {
            color: '#6b7280',
            fontSize: '14px',
          },
        }}
        locale={{
          back: '이전',
          close: '닫기',
          last: '완료',
          next: '다음',
          skip: '건너뛰기',
        }}
      />
    </TutorialContext.Provider>
  );
}
```

### 3단계: HR 시스템 전용 튜토리얼 단계 정의

```typescript
// lib/tutorial/hr-tutorial-steps.ts
import { Step } from 'react-joyride';

export const hrDashboardSteps: Step[] = [
  {
    target: '.dashboard-header',
    content: '안녕하세요! HR 관리 시스템에 오신 것을 환영합니다. 주요 기능들을 안내해드리겠습니다.',
    placement: 'bottom',
    disableBeacon: true,
  },
  {
    target: '.sidebar-navigation',
    content: '왼쪽 사이드바에서 직원 관리, 급여 계산, 근무 일정 등 모든 기능에 접근할 수 있습니다.',
    placement: 'right',
  },
  {
    target: '.employee-section',
    content: '직원 관리 섹션에서는 직원 정보 등록, 수정, 조회가 가능합니다.',
    placement: 'bottom',
  },
  {
    target: '.payroll-section',
    content: '급여 계산 기능으로 월급, 시급, 4대보험 등을 자동으로 계산할 수 있습니다.',
    placement: 'bottom',
  },
  {
    target: '.schedule-section',
    content: '근무 일정 관리에서는 직원들의 스케줄을 효율적으로 관리할 수 있습니다.',
    placement: 'bottom',
  },
  {
    target: '.settings-button',
    content: '설정 버튼을 클릭하면 시스템 환경설정을 변경할 수 있습니다.',
    placement: 'left',
  },
  {
    target: '.help-center',
    content: '도움이 필요하시면 언제든 도움말 센터를 이용해주세요. 튜토리얼을 완료했습니다!',
    placement: 'bottom',
  },
];

export const employeeManagementSteps: Step[] = [
  {
    target: '.add-employee-button',
    content: '새 직원을 등록하려면 이 버튼을 클릭하세요.',
    placement: 'bottom',
  },
  {
    target: '.employee-list',
    content: '등록된 모든 직원의 목록을 여기서 확인할 수 있습니다.',
    placement: 'top',
  },
  {
    target: '.search-filter',
    content: '검색과 필터 기능으로 원하는 직원을 빠르게 찾을 수 있습니다.',
    placement: 'bottom',
  },
  {
    target: '.employee-actions',
    content: '각 직원의 정보 수정, 삭제, 상세보기가 가능합니다.',
    placement: 'left',
  },
];

export const payrollSteps: Step[] = [
  {
    target: '.payroll-calculator',
    content: '급여 계산기에서 근무시간을 입력하면 자동으로 급여가 계산됩니다.',
    placement: 'top',
  },
  {
    target: '.work-hours-input',
    content: '주간 근무시간을 입력하세요. 40시간 또는 20시간 기준으로 계산됩니다.',
    placement: 'right',
  },
  {
    target: '.calculation-result',
    content: '세전 급여, 4대보험, 세금, 실수령액이 자동으로 계산되어 표시됩니다.',
    placement: 'left',
  },
  {
    target: '.payroll-history',
    content: '과거 급여 계산 내역을 여기서 확인할 수 있습니다.',
    placement: 'top',
  },
];
```

### 4단계: 튜토리얼 트리거 컴포넌트

```typescript
// components/tutorial/TutorialTrigger.tsx
'use client';

import { useEffect, useState } from 'react';
import { useTutorial } from './TutorialProvider';
import { hrDashboardSteps } from '@/lib/tutorial/hr-tutorial-steps';
import { Button } from '@/components/ui/button';
import { HelpCircle, Play } from 'lucide-react';

interface TutorialTriggerProps {
  page: 'dashboard' | 'employees' | 'payroll' | 'schedule';
  autoStart?: boolean;
}

export default function TutorialTrigger({ page, autoStart = false }: TutorialTriggerProps) {
  const { startTutorial } = useTutorial();
  const [shouldShowTutorial, setShouldShowTutorial] = useState(false);

  useEffect(() => {
    checkTutorialStatus();
  }, []);

  const checkTutorialStatus = async () => {
    try {
      // 로컬스토리지 확인
      const localCompleted = localStorage.getItem(`tutorial-${page}-completed`);
      
      // 데이터베이스 확인 (선택사항)
      const response = await fetch(`/api/user/tutorial-status?page=${page}`);
      const { completed } = await response.json();

      const isCompleted = localCompleted === 'true' || completed;
      
      if (!isCompleted && autoStart) {
        setShouldShowTutorial(true);
        setTimeout(() => {
          handleStartTutorial();
        }, 1000); // 페이지 로딩 후 1초 뒤 시작
      }
    } catch (error) {
      console.error('튜토리얼 상태 확인 실패:', error);
    }
  };

  const handleStartTutorial = () => {
    const steps = getStepsForPage(page);
    startTutorial(steps);
  };

  const getStepsForPage = (pageName: string) => {
    switch (pageName) {
      case 'dashboard':
        return hrDashboardSteps;
      case 'employees':
        return employeeManagementSteps;
      case 'payroll':
        return payrollSteps;
      default:
        return hrDashboardSteps;
    }
  };

  return (
    <div className="tutorial-trigger">
      {/* 자동 시작되지 않은 경우 수동 시작 버튼 */}
      {!autoStart && (
        <Button
          variant="outline"
          size="sm"
          onClick={handleStartTutorial}
          className="flex items-center gap-2"
        >
          <HelpCircle className="w-4 h-4" />
          튜토리얼 시작
        </Button>
      )}

      {/* 첫 방문자를 위한 환영 메시지 */}
      {shouldShowTutorial && (
        <div className="fixed top-4 right-4 bg-blue-50 border border-blue-200 rounded-lg p-4 shadow-lg z-50">
          <div className="flex items-start gap-3">
            <Play className="w-5 h-5 text-blue-600 mt-0.5" />
            <div>
              <h4 className="font-semibold text-blue-900">처음 방문하셨나요?</h4>
              <p className="text-sm text-blue-700 mt-1">
                HR 시스템 사용법을 안내해드리겠습니다.
              </p>
              <div className="flex gap-2 mt-3">
                <Button
                  size="sm"
                  onClick={handleStartTutorial}
                  className="bg-blue-600 hover:bg-blue-700"
                >
                  튜토리얼 시작
                </Button>
                <Button
                  variant="outline"
                  size="sm"
                  onClick={() => {
                    setShouldShowTutorial(false);
                    localStorage.setItem(`tutorial-${page}-completed`, 'true');
                  }}
                >
                  건너뛰기
                </Button>
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}
```

### 5단계: 데이터베이스 스키마 (선택사항)

```sql
-- 사용자별 튜토리얼 완료 상태 저장
CREATE TABLE user_tutorial_status (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id) NOT NULL,
  page_name VARCHAR(50) NOT NULL,
  completed BOOLEAN DEFAULT false,
  completed_at TIMESTAMP WITH TIME ZONE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(user_id, page_name)
);

-- 튜토리얼 단계별 진행 상황 (상세 분석용)
CREATE TABLE tutorial_progress (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id) NOT NULL,
  page_name VARCHAR(50) NOT NULL,
  step_index INTEGER NOT NULL,
  action VARCHAR(20) NOT NULL, -- 'next', 'prev', 'skip', 'close'
  timestamp TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

### 6단계: API 라우트 구현

```typescript
// app/api/user/tutorial-status/route.ts
import { NextRequest, NextResponse } from 'next/server';
import { createClient } from '@supabase/supabase-js';

const supabase = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL!,
  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
);

export async function GET(request: NextRequest) {
  try {
    const { searchParams } = new URL(request.url);
    const page = searchParams.get('page');
    const userId = request.headers.get('user-id'); // 인증에서 가져온 사용자 ID

    if (!userId || !page) {
      return NextResponse.json(
        { error: '사용자 ID와 페이지 정보가 필요합니다.' },
        { status: 400 }
      );
    }

    const { data, error } = await supabase
      .from('user_tutorial_status')
      .select('completed')
      .eq('user_id', userId)
      .eq('page_name', page)
      .single();

    if (error && error.code !== 'PGRST116') { // PGRST116 = no rows found
      throw error;
    }

    return NextResponse.json({
      completed: data?.completed || false,
    });

  } catch (error) {
    console.error('튜토리얼 상태 조회 오류:', error);
    return NextResponse.json(
      { error: '튜토리얼 상태 조회에 실패했습니다.' },
      { status: 500 }
    );
  }
}

export async function POST(request: NextRequest) {
  try {
    const { page, completed } = await request.json();
    const userId = request.headers.get('user-id');

    if (!userId || !page) {
      return NextResponse.json(
        { error: '사용자 ID와 페이지 정보가 필요합니다.' },
        { status: 400 }
      );
    }

    const { error } = await supabase
      .from('user_tutorial_status')
      .upsert({
        user_id: userId,
        page_name: page,
        completed,
        completed_at: completed ? new Date().toISOString() : null,
      });

    if (error) throw error;

    return NextResponse.json({ success: true });

  } catch (error) {
    console.error('튜토리얼 상태 저장 오류:', error);
    return NextResponse.json(
      { error: '튜토리얼 상태 저장에 실패했습니다.' },
      { status: 500 }
    );
  }
}
```

### 7단계: 페이지별 튜토리얼 적용

```typescript
// app/dashboard/page.tsx
import TutorialTrigger from '@/components/tutorial/TutorialTrigger';

export default function DashboardPage() {
  return (
    <div className="dashboard-container">
      {/* 튜토리얼 트리거 - 첫 방문 시 자동 시작 */}
      <TutorialTrigger page="dashboard" autoStart={true} />
      
      <header className="dashboard-header">
        <h1>HR 관리 대시보드</h1>
        {/* 수동 튜토리얼 시작 버튼 */}
        <TutorialTrigger page="dashboard" />
      </header>

      <aside className="sidebar-navigation">
        {/* 사이드바 내용 */}
      </aside>

      <main className="dashboard-content">
        <section className="employee-section">
          {/* 직원 관리 섹션 */}
        </section>
        
        <section className="payroll-section">
          {/* 급여 계산 섹션 */}
        </section>
        
        <section className="schedule-section">
          {/* 일정 관리 섹션 */}
        </section>
      </main>
    </div>
  );
}
```

### 8단계: 고급 기능 구현

#### 조건부 튜토리얼
```typescript
// components/tutorial/ConditionalTutorial.tsx
export default function ConditionalTutorial() {
  const [userRole, setUserRole] = useState<'admin' | 'hr' | 'employee'>('employee');

  const getStepsForRole = (role: string) => {
    switch (role) {
      case 'admin':
        return adminTutorialSteps;
      case 'hr':
        return hrManagerSteps;
      case 'employee':
        return employeeSteps;
      default:
        return basicSteps;
    }
  };

  // 역할별 다른 튜토리얼 제공
}
```

#### 진행률 추적
```typescript
// components/tutorial/TutorialProgress.tsx
export default function TutorialProgress() {
  const [progress, setProgress] = useState(0);

  const trackProgress = async (stepIndex: number, totalSteps: number) => {
    const progressPercent = ((stepIndex + 1) / totalSteps) * 100;
    setProgress(progressPercent);

    // 진행률 저장
    await fetch('/api/tutorial/progress', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        step_index: stepIndex,
        progress_percent: progressPercent,
      }),
    });
  };

  return (
    <div className="tutorial-progress">
      <div className="progress-bar">
        <div 
          className="progress-fill" 
          style={{ width: `${progress}%` }}
        />
      </div>
      <span className="progress-text">{Math.round(progress)}% 완료</span>
    </div>
  );
}
```

#### 다국어 지원
```typescript
// lib/tutorial/i18n.ts
export const tutorialTexts = {
  ko: {
    welcome: '안녕하세요! HR 관리 시스템에 오신 것을 환영합니다.',
    next: '다음',
    prev: '이전',
    skip: '건너뛰기',
    finish: '완료',
  },
  en: {
    welcome: 'Welcome to the HR Management System!',
    next: 'Next',
    prev: 'Previous',
    skip: 'Skip',
    finish: 'Finish',
  },
};
```

## 사용자 경험 최적화

### 1. 적절한 타이밍
- **첫 방문**: 회원가입 직후 또는 첫 로그인 시
- **기능 업데이트**: 새로운 기능 추가 시
- **사용자 요청**: 도움말 버튼 클릭 시

### 2. 개인화
- **역할별 튜토리얼**: 관리자, HR 담당자, 일반 직원별 다른 내용
- **진행률 저장**: 중단된 지점부터 재시작 가능
- **선택적 표시**: 사용자가 원하지 않으면 건너뛰기 가능

### 3. 성능 고려사항
- **지연 로딩**: 튜토리얼 라이브러리는 필요할 때만 로드
- **캐싱**: 튜토리얼 완료 상태는 로컬스토리지에 캐시
- **최적화**: 불필요한 API 호출 최소화

## 분석 및 개선

### 1. 사용 통계 수집
```typescript
// 튜토리얼 사용 패턴 분석
const trackTutorialEvent = async (event: string, data: any) => {
  await fetch('/api/analytics/tutorial', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      event,
      data,
      timestamp: new Date().toISOString(),
    }),
  });
};
```

### 2. A/B 테스트
```typescript
// 다양한 튜토리얼 버전 테스트
const getTutorialVersion = () => {
  const versions = ['v1', 'v2', 'v3'];
  const userHash = hashUserId(userId);
  return versions[userHash % versions.length];
};
```

### 3. 피드백 수집
```typescript
// 튜토리얼 완료 후 피드백 요청
const collectFeedback = async (rating: number, comment: string) => {
  await fetch('/api/tutorial/feedback', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ rating, comment }),
  });
};
```

## 결론

웹사이트 튜토리얼 구현을 통해 다음과 같은 효과를 얻을 수 있습니다:

### 장점
1. **사용자 온보딩**: 새 사용자의 빠른 적응 지원
2. **기능 발견**: 숨겨진 기능들의 활용도 증가
3. **지원 요청 감소**: 자주 묻는 질문 사전 해결
4. **사용자 만족도**: 직관적인 사용 경험 제공

### 주의사항
1. **과도한 안내 방지**: 너무 많은 단계는 오히려 방해
2. **건너뛰기 옵션**: 사용자 선택권 보장
3. **모바일 최적화**: 다양한 화면 크기 고려
4. **접근성**: 스크린 리더 등 보조 기술 지원

이러한 체계적인 접근을 통해 사용자 친화적인 튜토리얼 시스템을 성공적으로 구축할 수 있습니다.
