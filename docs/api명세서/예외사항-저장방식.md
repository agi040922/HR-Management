# ì˜ˆì™¸ì‚¬í•­ ì €ì¥ ë°©ì‹ API ëª…ì„¸ì„œ

## ğŸ“‹ ê°œìš”
HR ê´€ë¦¬ ì‹œìŠ¤í…œì˜ ì˜ˆì™¸ì‚¬í•­ ì €ì¥ í”„ë¡œì„¸ìŠ¤ì™€ ë°ì´í„° êµ¬ì¡°ë¥¼ ì„¤ëª…í•©ë‹ˆë‹¤.

## ğŸ”§ í•µì‹¬ í•¨ìˆ˜

### `buildExceptionDataFromWizard()`
ìœ„ì €ë“œ ë°ì´í„°ë¥¼ DB ì €ì¥ìš© í˜•íƒœë¡œ ë³€í™˜í•©ë‹ˆë‹¤.

```typescript
function buildExceptionDataFromWizard(
  wizardData: ExceptionWizardData,
  storeId: number
): ExceptionData
```

## ğŸ“Š ì €ì¥ ë°ì´í„° êµ¬ì¡°

### ê³µí†µ í•„ë“œ
```typescript
{
  store_id: number,           // ìŠ¤í† ì–´ ID
  employee_id: number,        // ì§ì› ID  
  template_id: number,        // í…œí”Œë¦¿ ID
  date: string,              // ë‚ ì§œ (YYYY-MM-DD)
  exception_type: string,    // ì˜ˆì™¸ì‚¬í•­ ìœ í˜•
  notes?: string,            // ë©”ëª¨ (ì„ íƒì‚¬í•­)
  exception_data: {},        // ë¹ˆ ê°ì²´ (í˜¸í™˜ì„±)
  affected_slots: []         // ë¹ˆ ë°°ì—´ (í˜¸í™˜ì„±)
}
```

## ğŸ¯ ì˜ˆì™¸ì‚¬í•­ ìœ í˜•ë³„ ì €ì¥

### 1. íœ´ë¬´ (CANCEL)
```json
{
  "store_id": 5,
  "employee_id": 12,
  "template_id": 11,
  "date": "2025-08-29",
  "exception_type": "CANCEL",
  "start_time": undefined,
  "end_time": undefined,
  "notes": "ê°œì¸ì‚¬ì •ìœ¼ë¡œ ì¸í•œ íœ´ë¬´"
}
```

### 2. ì‹œê°„ë³€ê²½ (OVERRIDE)
```json
{
  "store_id": 5,
  "employee_id": 12,
  "template_id": 11,
  "date": "2025-08-29",
  "exception_type": "OVERRIDE",
  "start_time": "10:00",
  "end_time": "18:00",
  "notes": "ê°œì¸ì‚¬ì •ìœ¼ë¡œ ì‹œê°„ ë³€ê²½"
}
```

### 3. ì¶”ê°€ê·¼ë¬´ (EXTRA)
```json
{
  "store_id": 5,
  "employee_id": 12,
  "template_id": 11,
  "date": "2025-08-29",
  "exception_type": "EXTRA",
  "start_time": "21:00",
  "end_time": "23:00",
  "notes": "ì•¼ê°„ ì¶”ê°€ ê·¼ë¬´"
}
```

## ğŸ” DB ì œì•½ì¡°ê±´

### exception_type í—ˆìš© ê°’
- `'CANCEL'` - íœ´ë¬´
- `'OVERRIDE'` - ì‹œê°„ë³€ê²½  
- `'EXTRA'` - ì¶”ê°€ê·¼ë¬´

### ìœ ë‹ˆí¬ ì œì•½ì¡°ê±´
```sql
UNIQUE(template_id, employee_id, date, exception_type)
```

## âš¡ ì €ì¥ í”„ë¡œì„¸ìŠ¤

1. **ìœ„ì €ë“œ ë°ì´í„° ìˆ˜ì§‘** â†’ ExceptionWizardData
2. **ë°ì´í„° ë³€í™˜** â†’ buildExceptionDataFromWizard()
3. **DB ì €ì¥** â†’ createException()
4. **ì„±ê³µ ì²˜ë¦¬** â†’ ëª©ë¡ ìƒˆë¡œê³ ì¹¨

## ğŸš¨ ì£¼ìš” ë³€ê²½ì‚¬í•­

- **JSONB í•„ë“œ ìµœì í™”**: `exception_data`, `affected_slots`ë¥¼ ë¹ˆ ê°ì²´/ë°°ì—´ë¡œ ì €ì¥
- **íƒ€ì… í†µì¼**: `ADDITIONAL` â†’ `EXTRA`ë¡œ ë³€ê²½í•˜ì—¬ DB ì œì•½ì¡°ê±´ê³¼ ì¼ì¹˜
- **ë‹¨ìˆœí™”**: ëª¨ë“  ì˜ˆì™¸ì‚¬í•­ ìœ í˜•ì´ ë™ì¼í•œ ì €ì¥ ë¡œì§ ì‚¬ìš©
